{"ast":null,"code":"\"use strict\";\n\nvar _regeneratorRuntime = require(\"/mnt/c/Users/PC/Documents/PolkadotHelloWorld/PolkadotHelloWorld/Front-End-Project1/substrate-node-template/substrate-front-end-template/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\");\n\nvar _asyncToGenerator = require(\"/mnt/c/Users/PC/Documents/PolkadotHelloWorld/PolkadotHelloWorld/Front-End-Project1/substrate-node-template/substrate-front-end-template/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/asyncToGenerator\");\n\nvar _classCallCheck = require(\"/mnt/c/Users/PC/Documents/PolkadotHelloWorld/PolkadotHelloWorld/Front-End-Project1/substrate-node-template/substrate-front-end-template/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"/mnt/c/Users/PC/Documents/PolkadotHelloWorld/PolkadotHelloWorld/Front-End-Project1/substrate-node-template/substrate-front-end-template/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createClass\");\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _classPrivateFieldLooseBase2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classPrivateFieldLooseBase\"));\n\nvar _classPrivateFieldLooseKey2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classPrivateFieldLooseKey\"));\n\nvar _eventemitter2 = _interopRequireDefault(require(\"eventemitter3\"));\n\nvar _util = require(\"@polkadot/util\");\n\nvar _xWs = _interopRequireDefault(require(\"@polkadot/x-ws\"));\n\nvar _coder2 = _interopRequireDefault(require(\"../coder\"));\n\nvar _defaults = _interopRequireDefault(require(\"../defaults\"));\n\nvar _errors = require(\"./errors\");\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        (0, _defineProperty2.default)(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nvar ALIASSES = {\n  chain_finalisedHead: 'chain_finalizedHead',\n  chain_subscribeFinalisedHeads: 'chain_subscribeFinalizedHeads',\n  chain_unsubscribeFinalisedHeads: 'chain_unsubscribeFinalizedHeads'\n};\nvar RETRY_DELAY = 1000;\nvar l = (0, _util.logger)('api-ws');\n/**\n * # @polkadot/rpc-provider/ws\n *\n * @name WsProvider\n *\n * @description The WebSocket Provider allows sending requests using WebSocket to a WebSocket RPC server TCP port. Unlike the [[HttpProvider]], it does support subscriptions and allows listening to events such as new blocks or balance changes.\n *\n * @example\n * <BR>\n *\n * ```javascript\n * import Api from '@polkadot/api/promise';\n * import WsProvider from '@polkadot/rpc-provider/ws';\n *\n * const provider = new WsProvider('ws://127.0.0.1:9944');\n * const api = new Api(provider);\n * ```\n *\n * @see [[HttpProvider]]\n */\n\nvar _coder = (0, _classPrivateFieldLooseKey2.default)(\"coder\");\n\nvar _endpoints = (0, _classPrivateFieldLooseKey2.default)(\"endpoints\");\n\nvar _headers = (0, _classPrivateFieldLooseKey2.default)(\"headers\");\n\nvar _eventemitter = (0, _classPrivateFieldLooseKey2.default)(\"eventemitter\");\n\nvar _handlers = (0, _classPrivateFieldLooseKey2.default)(\"handlers\");\n\nvar _queued = (0, _classPrivateFieldLooseKey2.default)(\"queued\");\n\nvar _waitingForId = (0, _classPrivateFieldLooseKey2.default)(\"waitingForId\");\n\nvar _autoConnectMs = (0, _classPrivateFieldLooseKey2.default)(\"autoConnectMs\");\n\nvar _endpointIndex = (0, _classPrivateFieldLooseKey2.default)(\"endpointIndex\");\n\nvar _isConnected = (0, _classPrivateFieldLooseKey2.default)(\"isConnected\");\n\nvar _subscriptions = (0, _classPrivateFieldLooseKey2.default)(\"subscriptions\");\n\nvar _websocket = (0, _classPrivateFieldLooseKey2.default)(\"websocket\");\n\nvar _emit = (0, _classPrivateFieldLooseKey2.default)(\"emit\");\n\nvar _onSocketClose = (0, _classPrivateFieldLooseKey2.default)(\"onSocketClose\");\n\nvar _onSocketError = (0, _classPrivateFieldLooseKey2.default)(\"onSocketError\");\n\nvar _onSocketMessage = (0, _classPrivateFieldLooseKey2.default)(\"onSocketMessage\");\n\nvar _onSocketMessageResult = (0, _classPrivateFieldLooseKey2.default)(\"onSocketMessageResult\");\n\nvar _onSocketMessageSubscribe = (0, _classPrivateFieldLooseKey2.default)(\"onSocketMessageSubscribe\");\n\nvar _onSocketOpen = (0, _classPrivateFieldLooseKey2.default)(\"onSocketOpen\");\n\nvar _resubscribe = (0, _classPrivateFieldLooseKey2.default)(\"resubscribe\");\n\nvar _sendQueue = (0, _classPrivateFieldLooseKey2.default)(\"sendQueue\");\n\nvar WsProvider = /*#__PURE__*/function () {\n  /**\n   * @param {string | string[]}  endpoint    The endpoint url. Usually `ws://ip:9944` or `wss://ip:9944`, may provide an array of endpoint strings.\n   * @param {boolean} autoConnect Whether to connect automatically or not.\n   */\n  function WsProvider() {\n    var _this = this;\n\n    var endpoint = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : _defaults.default.WS_URL;\n    var autoConnectMs = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : RETRY_DELAY;\n    var headers = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n    _classCallCheck(this, WsProvider);\n\n    Object.defineProperty(this, _coder, {\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, _endpoints, {\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, _headers, {\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, _eventemitter, {\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, _handlers, {\n      writable: true,\n      value: {}\n    });\n    Object.defineProperty(this, _queued, {\n      writable: true,\n      value: {}\n    });\n    Object.defineProperty(this, _waitingForId, {\n      writable: true,\n      value: {}\n    });\n    Object.defineProperty(this, _autoConnectMs, {\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, _endpointIndex, {\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, _isConnected, {\n      writable: true,\n      value: false\n    });\n    Object.defineProperty(this, _subscriptions, {\n      writable: true,\n      value: {}\n    });\n    Object.defineProperty(this, _websocket, {\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, _emit, {\n      writable: true,\n      value: function value(type) {\n        var _eventemitter3;\n\n        for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n          args[_key - 1] = arguments[_key];\n        }\n\n        (_eventemitter3 = (0, _classPrivateFieldLooseBase2.default)(_this, _eventemitter)[_eventemitter]).emit.apply(_eventemitter3, [type].concat(args));\n      }\n    });\n    Object.defineProperty(this, _onSocketClose, {\n      writable: true,\n      value: function value(event) {\n        if ((0, _classPrivateFieldLooseBase2.default)(_this, _autoConnectMs)[_autoConnectMs] > 0) {\n          l.error(\"disconnected from \".concat((0, _classPrivateFieldLooseBase2.default)(_this, _endpoints)[_endpoints][(0, _classPrivateFieldLooseBase2.default)(_this, _endpointIndex)[_endpointIndex]], \": \").concat(event.code, \":: \").concat(event.reason || (0, _errors.getWSErrorString)(event.code)));\n        }\n\n        (0, _classPrivateFieldLooseBase2.default)(_this, _isConnected)[_isConnected] = false;\n\n        (0, _classPrivateFieldLooseBase2.default)(_this, _emit)[_emit]('disconnected');\n\n        if ((0, _classPrivateFieldLooseBase2.default)(_this, _autoConnectMs)[_autoConnectMs] > 0) {\n          setTimeout(function () {\n            _this.connectWithRetry().catch(function () {// does not throw\n            });\n          }, (0, _classPrivateFieldLooseBase2.default)(_this, _autoConnectMs)[_autoConnectMs]);\n        }\n      }\n    });\n    Object.defineProperty(this, _onSocketError, {\n      writable: true,\n      value: function value(error) {\n        l.debug(function () {\n          return ['socket error', error];\n        });\n\n        (0, _classPrivateFieldLooseBase2.default)(_this, _emit)[_emit]('error', error);\n      }\n    });\n    Object.defineProperty(this, _onSocketMessage, {\n      writable: true,\n      value: function value(message) {\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n        l.debug(function () {\n          return ['received', message.data];\n        });\n        var response = JSON.parse(message.data);\n        return (0, _util.isUndefined)(response.method) ? (0, _classPrivateFieldLooseBase2.default)(_this, _onSocketMessageResult)[_onSocketMessageResult](response) : (0, _classPrivateFieldLooseBase2.default)(_this, _onSocketMessageSubscribe)[_onSocketMessageSubscribe](response);\n      }\n    });\n    Object.defineProperty(this, _onSocketMessageResult, {\n      writable: true,\n      value: function value(response) {\n        var handler = (0, _classPrivateFieldLooseBase2.default)(_this, _handlers)[_handlers][response.id];\n\n        if (!handler) {\n          l.debug(function () {\n            return \"Unable to find handler for id=\".concat(response.id);\n          });\n          return;\n        }\n\n        try {\n          var method = handler.method,\n              params = handler.params,\n              subscription = handler.subscription;\n\n          var result = (0, _classPrivateFieldLooseBase2.default)(_this, _coder)[_coder].decodeResponse(response); // first send the result - in case of subs, we may have an update\n          // immediately if we have some queued results already\n\n\n          handler.callback(null, result);\n\n          if (subscription) {\n            var subId = \"\".concat(subscription.type, \"::\").concat(result);\n            (0, _classPrivateFieldLooseBase2.default)(_this, _subscriptions)[_subscriptions][subId] = _objectSpread(_objectSpread({}, subscription), {}, {\n              method: method,\n              params: params\n            }); // if we have a result waiting for this subscription already\n\n            if ((0, _classPrivateFieldLooseBase2.default)(_this, _waitingForId)[_waitingForId][subId]) {\n              (0, _classPrivateFieldLooseBase2.default)(_this, _onSocketMessageSubscribe)[_onSocketMessageSubscribe]((0, _classPrivateFieldLooseBase2.default)(_this, _waitingForId)[_waitingForId][subId]);\n            }\n          }\n        } catch (error) {\n          handler.callback(error, undefined);\n        }\n\n        delete (0, _classPrivateFieldLooseBase2.default)(_this, _handlers)[_handlers][response.id];\n      }\n    });\n    Object.defineProperty(this, _onSocketMessageSubscribe, {\n      writable: true,\n      value: function value(response) {\n        var method = ALIASSES[response.method] || response.method || 'invalid';\n        var subId = \"\".concat(method, \"::\").concat(response.params.subscription);\n\n        var handler = (0, _classPrivateFieldLooseBase2.default)(_this, _subscriptions)[_subscriptions][subId];\n\n        if (!handler) {\n          // store the JSON, we could have out-of-order subid coming in\n          (0, _classPrivateFieldLooseBase2.default)(_this, _waitingForId)[_waitingForId][subId] = response;\n          l.debug(function () {\n            return \"Unable to find handler for subscription=\".concat(subId);\n          });\n          return;\n        } // housekeeping\n\n\n        delete (0, _classPrivateFieldLooseBase2.default)(_this, _waitingForId)[_waitingForId][subId];\n\n        try {\n          var result = (0, _classPrivateFieldLooseBase2.default)(_this, _coder)[_coder].decodeResponse(response);\n\n          handler.callback(null, result);\n        } catch (error) {\n          handler.callback(error, undefined);\n        }\n      }\n    });\n    Object.defineProperty(this, _onSocketOpen, {\n      writable: true,\n      value: function value() {\n        (0, _util.assert)(!(0, _util.isNull)((0, _classPrivateFieldLooseBase2.default)(_this, _websocket)[_websocket]), 'WebSocket cannot be null in onOpen');\n        l.debug(function () {\n          return ['connected to', (0, _classPrivateFieldLooseBase2.default)(_this, _endpoints)[_endpoints][(0, _classPrivateFieldLooseBase2.default)(_this, _endpointIndex)[_endpointIndex]]];\n        });\n        (0, _classPrivateFieldLooseBase2.default)(_this, _isConnected)[_isConnected] = true;\n\n        (0, _classPrivateFieldLooseBase2.default)(_this, _emit)[_emit]('connected');\n\n        (0, _classPrivateFieldLooseBase2.default)(_this, _sendQueue)[_sendQueue]();\n\n        (0, _classPrivateFieldLooseBase2.default)(_this, _resubscribe)[_resubscribe]();\n\n        return true;\n      }\n    });\n    Object.defineProperty(this, _resubscribe, {\n      writable: true,\n      value: function value() {\n        var subscriptions = (0, _classPrivateFieldLooseBase2.default)(_this, _subscriptions)[_subscriptions];\n\n        (0, _classPrivateFieldLooseBase2.default)(_this, _subscriptions)[_subscriptions] = {}; // eslint-disable-next-line @typescript-eslint/no-misused-promises\n\n        Object.keys(subscriptions).forEach( /*#__PURE__*/function () {\n          var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(id) {\n            var _subscriptions$id, callback, method, params, type;\n\n            return _regeneratorRuntime.wrap(function _callee$(_context) {\n              while (1) {\n                switch (_context.prev = _context.next) {\n                  case 0:\n                    _subscriptions$id = subscriptions[id], callback = _subscriptions$id.callback, method = _subscriptions$id.method, params = _subscriptions$id.params, type = _subscriptions$id.type; // only re-create subscriptions which are not in author (only area where\n                    // transactions are created, i.e. submissions such as 'author_submitAndWatchExtrinsic'\n                    // are not included (and will not be re-broadcast)\n\n                    if (!type.startsWith('author_')) {\n                      _context.next = 3;\n                      break;\n                    }\n\n                    return _context.abrupt(\"return\");\n\n                  case 3:\n                    _context.prev = 3;\n                    _context.next = 6;\n                    return _this.subscribe(type, method, params, callback);\n\n                  case 6:\n                    _context.next = 11;\n                    break;\n\n                  case 8:\n                    _context.prev = 8;\n                    _context.t0 = _context[\"catch\"](3);\n                    l.error(_context.t0);\n\n                  case 11:\n                  case \"end\":\n                    return _context.stop();\n                }\n              }\n            }, _callee, null, [[3, 8]]);\n          }));\n\n          return function (_x) {\n            return _ref.apply(this, arguments);\n          };\n        }());\n      }\n    });\n    Object.defineProperty(this, _sendQueue, {\n      writable: true,\n      value: function value() {\n        Object.keys((0, _classPrivateFieldLooseBase2.default)(_this, _queued)[_queued]).forEach(function (id) {\n          try {\n            // we have done the websocket check in onSocketOpen, if an issue, will catch it\n            (0, _classPrivateFieldLooseBase2.default)(_this, _websocket)[_websocket].send((0, _classPrivateFieldLooseBase2.default)(_this, _queued)[_queued][id]);\n\n            delete (0, _classPrivateFieldLooseBase2.default)(_this, _queued)[_queued][id];\n          } catch (error) {\n            l.error(error);\n          }\n        });\n      }\n    });\n    var endpoints = Array.isArray(endpoint) ? endpoint : [endpoint];\n    (0, _util.assert)(endpoints.length !== 0, 'WsProvider requires at least one Endpoint');\n    endpoints.forEach(function (endpoint) {\n      (0, _util.assert)(/^(wss|ws):\\/\\//.test(endpoint), \"Endpoint should start with 'ws://', received '\".concat(endpoint, \"'\"));\n    });\n    (0, _classPrivateFieldLooseBase2.default)(this, _eventemitter)[_eventemitter] = new _eventemitter2.default();\n    (0, _classPrivateFieldLooseBase2.default)(this, _autoConnectMs)[_autoConnectMs] = autoConnectMs || 0;\n    (0, _classPrivateFieldLooseBase2.default)(this, _coder)[_coder] = new _coder2.default();\n    (0, _classPrivateFieldLooseBase2.default)(this, _endpointIndex)[_endpointIndex] = -1;\n    (0, _classPrivateFieldLooseBase2.default)(this, _endpoints)[_endpoints] = endpoints;\n    (0, _classPrivateFieldLooseBase2.default)(this, _headers)[_headers] = headers;\n    (0, _classPrivateFieldLooseBase2.default)(this, _websocket)[_websocket] = null;\n\n    if (autoConnectMs > 0) {\n      this.connectWithRetry().catch(function () {// does not throw\n      });\n    }\n  }\n  /**\n   * @summary `true` when this provider supports subscriptions\n   */\n\n\n  _createClass(WsProvider, [{\n    key: \"clone\",\n\n    /**\n     * @description Returns a clone of the object\n     */\n    value: function clone() {\n      return new WsProvider((0, _classPrivateFieldLooseBase2.default)(this, _endpoints)[_endpoints]);\n    }\n    /**\n     * @summary Manually connect\n     * @description The [[WsProvider]] connects automatically by default, however if you decided otherwise, you may\n     * connect manually using this method.\n     */\n    // eslint-disable-next-line @typescript-eslint/require-await\n\n  }, {\n    key: \"connect\",\n    value: function () {\n      var _connect = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.prev = 0;\n                (0, _classPrivateFieldLooseBase2.default)(this, _endpointIndex)[_endpointIndex] = ((0, _classPrivateFieldLooseBase2.default)(this, _endpointIndex)[_endpointIndex] + 1) % (0, _classPrivateFieldLooseBase2.default)(this, _endpoints)[_endpoints].length;\n                (0, _classPrivateFieldLooseBase2.default)(this, _websocket)[_websocket] = typeof WebSocket !== 'undefined' && (0, _util.isChildClass)(WebSocket, _xWs.default) ? new _xWs.default((0, _classPrivateFieldLooseBase2.default)(this, _endpoints)[_endpoints][(0, _classPrivateFieldLooseBase2.default)(this, _endpointIndex)[_endpointIndex]]) // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n                // @ts-ignore - WS may be an instance of w3cwebsocket, which supports headers\n                : new _xWs.default((0, _classPrivateFieldLooseBase2.default)(this, _endpoints)[_endpoints][(0, _classPrivateFieldLooseBase2.default)(this, _endpointIndex)[_endpointIndex]], undefined, undefined, (0, _classPrivateFieldLooseBase2.default)(this, _headers)[_headers], undefined, {\n                  // default: true\n                  fragmentOutgoingMessages: true,\n                  // default: 16K\n                  fragmentationThreshold: 256 * 1024\n                });\n                (0, _classPrivateFieldLooseBase2.default)(this, _websocket)[_websocket].onclose = (0, _classPrivateFieldLooseBase2.default)(this, _onSocketClose)[_onSocketClose];\n                (0, _classPrivateFieldLooseBase2.default)(this, _websocket)[_websocket].onerror = (0, _classPrivateFieldLooseBase2.default)(this, _onSocketError)[_onSocketError];\n                (0, _classPrivateFieldLooseBase2.default)(this, _websocket)[_websocket].onmessage = (0, _classPrivateFieldLooseBase2.default)(this, _onSocketMessage)[_onSocketMessage];\n                (0, _classPrivateFieldLooseBase2.default)(this, _websocket)[_websocket].onopen = (0, _classPrivateFieldLooseBase2.default)(this, _onSocketOpen)[_onSocketOpen];\n                _context2.next = 14;\n                break;\n\n              case 9:\n                _context2.prev = 9;\n                _context2.t0 = _context2[\"catch\"](0);\n                l.error(_context2.t0);\n\n                (0, _classPrivateFieldLooseBase2.default)(this, _emit)[_emit]('error', _context2.t0);\n\n                throw _context2.t0;\n\n              case 14:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this, [[0, 9]]);\n      }));\n\n      function connect() {\n        return _connect.apply(this, arguments);\n      }\n\n      return connect;\n    }()\n    /**\n     * @description Connect, never throwing an error, but rather forcing a retry\n     */\n\n  }, {\n    key: \"connectWithRetry\",\n    value: function () {\n      var _connectWithRetry = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n        var _this2 = this;\n\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.prev = 0;\n                _context3.next = 3;\n                return this.connect();\n\n              case 3:\n                _context3.next = 8;\n                break;\n\n              case 5:\n                _context3.prev = 5;\n                _context3.t0 = _context3[\"catch\"](0);\n                setTimeout(function () {\n                  _this2.connectWithRetry().catch(function () {// does not throw\n                  });\n                }, (0, _classPrivateFieldLooseBase2.default)(this, _autoConnectMs)[_autoConnectMs] || RETRY_DELAY);\n\n              case 8:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this, [[0, 5]]);\n      }));\n\n      function connectWithRetry() {\n        return _connectWithRetry.apply(this, arguments);\n      }\n\n      return connectWithRetry;\n    }()\n    /**\n     * @description Manually disconnect from the connection, clearing autoconnect logic\n     */\n    // eslint-disable-next-line @typescript-eslint/require-await\n\n  }, {\n    key: \"disconnect\",\n    value: function () {\n      var _disconnect = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                _context4.prev = 0;\n                (0, _util.assert)(!(0, _util.isNull)((0, _classPrivateFieldLooseBase2.default)(this, _websocket)[_websocket]), 'Cannot disconnect on a non-connected websocket'); // switch off autoConnect, we are in manual mode now\n\n                (0, _classPrivateFieldLooseBase2.default)(this, _autoConnectMs)[_autoConnectMs] = 0; // 1000 - Normal closure; the connection successfully completed\n\n                (0, _classPrivateFieldLooseBase2.default)(this, _websocket)[_websocket].close(1000);\n\n                (0, _classPrivateFieldLooseBase2.default)(this, _websocket)[_websocket] = null;\n                _context4.next = 12;\n                break;\n\n              case 7:\n                _context4.prev = 7;\n                _context4.t0 = _context4[\"catch\"](0);\n                l.error(_context4.t0);\n\n                (0, _classPrivateFieldLooseBase2.default)(this, _emit)[_emit]('error', _context4.t0);\n\n                throw _context4.t0;\n\n              case 12:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this, [[0, 7]]);\n      }));\n\n      function disconnect() {\n        return _disconnect.apply(this, arguments);\n      }\n\n      return disconnect;\n    }()\n    /**\n     * @summary Listens on events after having subscribed using the [[subscribe]] function.\n     * @param  {ProviderInterfaceEmitted} type Event\n     * @param  {ProviderInterfaceEmitCb}  sub  Callback\n     * @return unsubscribe function\n     */\n\n  }, {\n    key: \"on\",\n    value: function on(type, sub) {\n      var _this3 = this;\n\n      (0, _classPrivateFieldLooseBase2.default)(this, _eventemitter)[_eventemitter].on(type, sub);\n\n      return function () {\n        (0, _classPrivateFieldLooseBase2.default)(_this3, _eventemitter)[_eventemitter].removeListener(type, sub);\n      };\n    }\n    /**\n     * @summary Send JSON data using WebSockets to configured HTTP Endpoint or queue.\n     * @param method The RPC methods to execute\n     * @param params Encoded paramaters as appliucable for the method\n     * @param subscription Subscription details (internally used)\n     */\n\n  }, {\n    key: \"send\",\n    value: function send(method, params, subscription) {\n      var _this4 = this;\n\n      return new Promise(function (resolve, reject) {\n        try {\n          var json = (0, _classPrivateFieldLooseBase2.default)(_this4, _coder)[_coder].encodeJson(method, params);\n\n          var id = (0, _classPrivateFieldLooseBase2.default)(_this4, _coder)[_coder].getId();\n\n          var callback = function callback(error, result) {\n            error ? reject(error) : resolve(result);\n          };\n\n          l.debug(function () {\n            return ['calling', method, json];\n          });\n          (0, _classPrivateFieldLooseBase2.default)(_this4, _handlers)[_handlers][id] = {\n            callback: callback,\n            method: method,\n            params: params,\n            subscription: subscription\n          };\n\n          if (_this4.isConnected && !(0, _util.isNull)((0, _classPrivateFieldLooseBase2.default)(_this4, _websocket)[_websocket])) {\n            (0, _classPrivateFieldLooseBase2.default)(_this4, _websocket)[_websocket].send(json);\n          } else {\n            (0, _classPrivateFieldLooseBase2.default)(_this4, _queued)[_queued][id] = json;\n          }\n        } catch (error) {\n          reject(error);\n        }\n      });\n    }\n    /**\n     * @name subscribe\n     * @summary Allows subscribing to a specific event.\n     * @param  {string}                     type     Subscription type\n     * @param  {string}                     method   Subscription method\n     * @param  {any[]}                 params   Parameters\n     * @param  {ProviderInterfaceCallback} callback Callback\n     * @return {Promise<number>}                     Promise resolving to the dd of the subscription you can use with [[unsubscribe]].\n     *\n     * @example\n     * <BR>\n     *\n     * ```javascript\n     * const provider = new WsProvider('ws://127.0.0.1:9944');\n     * const rpc = new Rpc(provider);\n     *\n     * rpc.state.subscribeStorage([[storage.system.account, <Address>]], (_, values) => {\n     *   console.log(values)\n     * }).then((subscriptionId) => {\n     *   console.log('balance changes subscription id: ', subscriptionId)\n     * })\n     * ```\n     */\n\n  }, {\n    key: \"subscribe\",\n    value: function () {\n      var _subscribe = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5(type, method, params, callback) {\n        var id;\n        return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                _context5.next = 2;\n                return this.send(method, params, {\n                  callback: callback,\n                  type: type\n                });\n\n              case 2:\n                id = _context5.sent;\n                return _context5.abrupt(\"return\", id);\n\n              case 4:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this);\n      }));\n\n      function subscribe(_x2, _x3, _x4, _x5) {\n        return _subscribe.apply(this, arguments);\n      }\n\n      return subscribe;\n    }()\n    /**\n     * @summary Allows unsubscribing to subscriptions made with [[subscribe]].\n     */\n\n  }, {\n    key: \"unsubscribe\",\n    value: function () {\n      var _unsubscribe = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee6(type, method, id) {\n        var subscription, result;\n        return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                subscription = \"\".concat(type, \"::\").concat(id); // FIXME This now could happen with re-subscriptions. The issue is that with a re-sub\n                // the assigned id now does not match what the API user originally received. It has\n                // a slight complication in solving - since we cannot rely on the send id, but rather\n                // need to find the actual subscription id to map it\n\n                if (!(0, _util.isUndefined)((0, _classPrivateFieldLooseBase2.default)(this, _subscriptions)[_subscriptions][subscription])) {\n                  _context6.next = 4;\n                  break;\n                }\n\n                l.debug(function () {\n                  return \"Unable to find active subscription=\".concat(subscription);\n                });\n                return _context6.abrupt(\"return\", false);\n\n              case 4:\n                delete (0, _classPrivateFieldLooseBase2.default)(this, _subscriptions)[_subscriptions][subscription];\n                _context6.next = 7;\n                return this.send(method, [id]);\n\n              case 7:\n                result = _context6.sent;\n                return _context6.abrupt(\"return\", result);\n\n              case 9:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6, this);\n      }));\n\n      function unsubscribe(_x6, _x7, _x8) {\n        return _unsubscribe.apply(this, arguments);\n      }\n\n      return unsubscribe;\n    }()\n  }, {\n    key: \"hasSubscriptions\",\n    get: function get() {\n      return true;\n    }\n    /**\n     * @summary Whether the node is connected or not.\n     * @return {boolean} true if connected\n     */\n\n  }, {\n    key: \"isConnected\",\n    get: function get() {\n      return (0, _classPrivateFieldLooseBase2.default)(this, _isConnected)[_isConnected];\n    }\n  }]);\n\n  return WsProvider;\n}();\n\nexports.default = WsProvider;","map":{"version":3,"sources":["/mnt/c/Users/PC/Documents/PolkadotHelloWorld/PolkadotHelloWorld/Front-End-Project1/substrate-node-template/substrate-front-end-template/node_modules/@polkadot/rpc-provider/ws/Provider.js"],"names":["_interopRequireDefault","require","Object","defineProperty","exports","value","default","_defineProperty2","_classPrivateFieldLooseBase2","_classPrivateFieldLooseKey2","_eventemitter2","_util","_xWs","_coder2","_defaults","_errors","ownKeys","object","enumerableOnly","keys","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","getOwnPropertyDescriptors","defineProperties","ALIASSES","chain_finalisedHead","chain_subscribeFinalisedHeads","chain_unsubscribeFinalisedHeads","RETRY_DELAY","l","logger","_coder","_endpoints","_headers","_eventemitter","_handlers","_queued","_waitingForId","_autoConnectMs","_endpointIndex","_isConnected","_subscriptions","_websocket","_emit","_onSocketClose","_onSocketError","_onSocketMessage","_onSocketMessageResult","_onSocketMessageSubscribe","_onSocketOpen","_resubscribe","_sendQueue","WsProvider","endpoint","WS_URL","autoConnectMs","headers","writable","type","args","emit","event","error","code","reason","getWSErrorString","setTimeout","connectWithRetry","catch","debug","message","data","response","JSON","parse","isUndefined","method","handler","id","params","subscription","result","decodeResponse","callback","subId","undefined","assert","isNull","subscriptions","startsWith","subscribe","send","endpoints","Array","isArray","test","WebSocket","isChildClass","fragmentOutgoingMessages","fragmentationThreshold","onclose","onerror","onmessage","onopen","connect","close","sub","on","removeListener","Promise","resolve","reject","json","encodeJson","getId","isConnected"],"mappings":"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","sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _classPrivateFieldLooseBase2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classPrivateFieldLooseBase\"));\n\nvar _classPrivateFieldLooseKey2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classPrivateFieldLooseKey\"));\n\nvar _eventemitter2 = _interopRequireDefault(require(\"eventemitter3\"));\n\nvar _util = require(\"@polkadot/util\");\n\nvar _xWs = _interopRequireDefault(require(\"@polkadot/x-ws\"));\n\nvar _coder2 = _interopRequireDefault(require(\"../coder\"));\n\nvar _defaults = _interopRequireDefault(require(\"../defaults\"));\n\nvar _errors = require(\"./errors\");\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2.default)(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nconst ALIASSES = {\n  chain_finalisedHead: 'chain_finalizedHead',\n  chain_subscribeFinalisedHeads: 'chain_subscribeFinalizedHeads',\n  chain_unsubscribeFinalisedHeads: 'chain_unsubscribeFinalizedHeads'\n};\nconst RETRY_DELAY = 1000;\nconst l = (0, _util.logger)('api-ws');\n/**\n * # @polkadot/rpc-provider/ws\n *\n * @name WsProvider\n *\n * @description The WebSocket Provider allows sending requests using WebSocket to a WebSocket RPC server TCP port. Unlike the [[HttpProvider]], it does support subscriptions and allows listening to events such as new blocks or balance changes.\n *\n * @example\n * <BR>\n *\n * ```javascript\n * import Api from '@polkadot/api/promise';\n * import WsProvider from '@polkadot/rpc-provider/ws';\n *\n * const provider = new WsProvider('ws://127.0.0.1:9944');\n * const api = new Api(provider);\n * ```\n *\n * @see [[HttpProvider]]\n */\n\nvar _coder = (0, _classPrivateFieldLooseKey2.default)(\"coder\");\n\nvar _endpoints = (0, _classPrivateFieldLooseKey2.default)(\"endpoints\");\n\nvar _headers = (0, _classPrivateFieldLooseKey2.default)(\"headers\");\n\nvar _eventemitter = (0, _classPrivateFieldLooseKey2.default)(\"eventemitter\");\n\nvar _handlers = (0, _classPrivateFieldLooseKey2.default)(\"handlers\");\n\nvar _queued = (0, _classPrivateFieldLooseKey2.default)(\"queued\");\n\nvar _waitingForId = (0, _classPrivateFieldLooseKey2.default)(\"waitingForId\");\n\nvar _autoConnectMs = (0, _classPrivateFieldLooseKey2.default)(\"autoConnectMs\");\n\nvar _endpointIndex = (0, _classPrivateFieldLooseKey2.default)(\"endpointIndex\");\n\nvar _isConnected = (0, _classPrivateFieldLooseKey2.default)(\"isConnected\");\n\nvar _subscriptions = (0, _classPrivateFieldLooseKey2.default)(\"subscriptions\");\n\nvar _websocket = (0, _classPrivateFieldLooseKey2.default)(\"websocket\");\n\nvar _emit = (0, _classPrivateFieldLooseKey2.default)(\"emit\");\n\nvar _onSocketClose = (0, _classPrivateFieldLooseKey2.default)(\"onSocketClose\");\n\nvar _onSocketError = (0, _classPrivateFieldLooseKey2.default)(\"onSocketError\");\n\nvar _onSocketMessage = (0, _classPrivateFieldLooseKey2.default)(\"onSocketMessage\");\n\nvar _onSocketMessageResult = (0, _classPrivateFieldLooseKey2.default)(\"onSocketMessageResult\");\n\nvar _onSocketMessageSubscribe = (0, _classPrivateFieldLooseKey2.default)(\"onSocketMessageSubscribe\");\n\nvar _onSocketOpen = (0, _classPrivateFieldLooseKey2.default)(\"onSocketOpen\");\n\nvar _resubscribe = (0, _classPrivateFieldLooseKey2.default)(\"resubscribe\");\n\nvar _sendQueue = (0, _classPrivateFieldLooseKey2.default)(\"sendQueue\");\n\nclass WsProvider {\n  /**\n   * @param {string | string[]}  endpoint    The endpoint url. Usually `ws://ip:9944` or `wss://ip:9944`, may provide an array of endpoint strings.\n   * @param {boolean} autoConnect Whether to connect automatically or not.\n   */\n  constructor(endpoint = _defaults.default.WS_URL, autoConnectMs = RETRY_DELAY, headers = {}) {\n    Object.defineProperty(this, _coder, {\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, _endpoints, {\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, _headers, {\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, _eventemitter, {\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, _handlers, {\n      writable: true,\n      value: {}\n    });\n    Object.defineProperty(this, _queued, {\n      writable: true,\n      value: {}\n    });\n    Object.defineProperty(this, _waitingForId, {\n      writable: true,\n      value: {}\n    });\n    Object.defineProperty(this, _autoConnectMs, {\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, _endpointIndex, {\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, _isConnected, {\n      writable: true,\n      value: false\n    });\n    Object.defineProperty(this, _subscriptions, {\n      writable: true,\n      value: {}\n    });\n    Object.defineProperty(this, _websocket, {\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, _emit, {\n      writable: true,\n      value: (type, ...args) => {\n        (0, _classPrivateFieldLooseBase2.default)(this, _eventemitter)[_eventemitter].emit(type, ...args);\n      }\n    });\n    Object.defineProperty(this, _onSocketClose, {\n      writable: true,\n      value: event => {\n        if ((0, _classPrivateFieldLooseBase2.default)(this, _autoConnectMs)[_autoConnectMs] > 0) {\n          l.error(`disconnected from ${(0, _classPrivateFieldLooseBase2.default)(this, _endpoints)[_endpoints][(0, _classPrivateFieldLooseBase2.default)(this, _endpointIndex)[_endpointIndex]]}: ${event.code}:: ${event.reason || (0, _errors.getWSErrorString)(event.code)}`);\n        }\n\n        (0, _classPrivateFieldLooseBase2.default)(this, _isConnected)[_isConnected] = false;\n\n        (0, _classPrivateFieldLooseBase2.default)(this, _emit)[_emit]('disconnected');\n\n        if ((0, _classPrivateFieldLooseBase2.default)(this, _autoConnectMs)[_autoConnectMs] > 0) {\n          setTimeout(() => {\n            this.connectWithRetry().catch(() => {// does not throw\n            });\n          }, (0, _classPrivateFieldLooseBase2.default)(this, _autoConnectMs)[_autoConnectMs]);\n        }\n      }\n    });\n    Object.defineProperty(this, _onSocketError, {\n      writable: true,\n      value: error => {\n        l.debug(() => ['socket error', error]);\n\n        (0, _classPrivateFieldLooseBase2.default)(this, _emit)[_emit]('error', error);\n      }\n    });\n    Object.defineProperty(this, _onSocketMessage, {\n      writable: true,\n      value: message => {\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n        l.debug(() => ['received', message.data]);\n        const response = JSON.parse(message.data);\n        return (0, _util.isUndefined)(response.method) ? (0, _classPrivateFieldLooseBase2.default)(this, _onSocketMessageResult)[_onSocketMessageResult](response) : (0, _classPrivateFieldLooseBase2.default)(this, _onSocketMessageSubscribe)[_onSocketMessageSubscribe](response);\n      }\n    });\n    Object.defineProperty(this, _onSocketMessageResult, {\n      writable: true,\n      value: response => {\n        const handler = (0, _classPrivateFieldLooseBase2.default)(this, _handlers)[_handlers][response.id];\n\n        if (!handler) {\n          l.debug(() => `Unable to find handler for id=${response.id}`);\n          return;\n        }\n\n        try {\n          const {\n            method,\n            params,\n            subscription\n          } = handler;\n\n          const result = (0, _classPrivateFieldLooseBase2.default)(this, _coder)[_coder].decodeResponse(response); // first send the result - in case of subs, we may have an update\n          // immediately if we have some queued results already\n\n\n          handler.callback(null, result);\n\n          if (subscription) {\n            const subId = `${subscription.type}::${result}`;\n            (0, _classPrivateFieldLooseBase2.default)(this, _subscriptions)[_subscriptions][subId] = _objectSpread(_objectSpread({}, subscription), {}, {\n              method,\n              params\n            }); // if we have a result waiting for this subscription already\n\n            if ((0, _classPrivateFieldLooseBase2.default)(this, _waitingForId)[_waitingForId][subId]) {\n              (0, _classPrivateFieldLooseBase2.default)(this, _onSocketMessageSubscribe)[_onSocketMessageSubscribe]((0, _classPrivateFieldLooseBase2.default)(this, _waitingForId)[_waitingForId][subId]);\n            }\n          }\n        } catch (error) {\n          handler.callback(error, undefined);\n        }\n\n        delete (0, _classPrivateFieldLooseBase2.default)(this, _handlers)[_handlers][response.id];\n      }\n    });\n    Object.defineProperty(this, _onSocketMessageSubscribe, {\n      writable: true,\n      value: response => {\n        const method = ALIASSES[response.method] || response.method || 'invalid';\n        const subId = `${method}::${response.params.subscription}`;\n\n        const handler = (0, _classPrivateFieldLooseBase2.default)(this, _subscriptions)[_subscriptions][subId];\n\n        if (!handler) {\n          // store the JSON, we could have out-of-order subid coming in\n          (0, _classPrivateFieldLooseBase2.default)(this, _waitingForId)[_waitingForId][subId] = response;\n          l.debug(() => `Unable to find handler for subscription=${subId}`);\n          return;\n        } // housekeeping\n\n\n        delete (0, _classPrivateFieldLooseBase2.default)(this, _waitingForId)[_waitingForId][subId];\n\n        try {\n          const result = (0, _classPrivateFieldLooseBase2.default)(this, _coder)[_coder].decodeResponse(response);\n\n          handler.callback(null, result);\n        } catch (error) {\n          handler.callback(error, undefined);\n        }\n      }\n    });\n    Object.defineProperty(this, _onSocketOpen, {\n      writable: true,\n      value: () => {\n        (0, _util.assert)(!(0, _util.isNull)((0, _classPrivateFieldLooseBase2.default)(this, _websocket)[_websocket]), 'WebSocket cannot be null in onOpen');\n        l.debug(() => ['connected to', (0, _classPrivateFieldLooseBase2.default)(this, _endpoints)[_endpoints][(0, _classPrivateFieldLooseBase2.default)(this, _endpointIndex)[_endpointIndex]]]);\n        (0, _classPrivateFieldLooseBase2.default)(this, _isConnected)[_isConnected] = true;\n\n        (0, _classPrivateFieldLooseBase2.default)(this, _emit)[_emit]('connected');\n\n        (0, _classPrivateFieldLooseBase2.default)(this, _sendQueue)[_sendQueue]();\n\n        (0, _classPrivateFieldLooseBase2.default)(this, _resubscribe)[_resubscribe]();\n\n        return true;\n      }\n    });\n    Object.defineProperty(this, _resubscribe, {\n      writable: true,\n      value: () => {\n        const subscriptions = (0, _classPrivateFieldLooseBase2.default)(this, _subscriptions)[_subscriptions];\n\n        (0, _classPrivateFieldLooseBase2.default)(this, _subscriptions)[_subscriptions] = {}; // eslint-disable-next-line @typescript-eslint/no-misused-promises\n\n        Object.keys(subscriptions).forEach(async id => {\n          const {\n            callback,\n            method,\n            params,\n            type\n          } = subscriptions[id]; // only re-create subscriptions which are not in author (only area where\n          // transactions are created, i.e. submissions such as 'author_submitAndWatchExtrinsic'\n          // are not included (and will not be re-broadcast)\n\n          if (type.startsWith('author_')) {\n            return;\n          }\n\n          try {\n            await this.subscribe(type, method, params, callback);\n          } catch (error) {\n            l.error(error);\n          }\n        });\n      }\n    });\n    Object.defineProperty(this, _sendQueue, {\n      writable: true,\n      value: () => {\n        Object.keys((0, _classPrivateFieldLooseBase2.default)(this, _queued)[_queued]).forEach(id => {\n          try {\n            // we have done the websocket check in onSocketOpen, if an issue, will catch it\n            (0, _classPrivateFieldLooseBase2.default)(this, _websocket)[_websocket].send((0, _classPrivateFieldLooseBase2.default)(this, _queued)[_queued][id]);\n\n            delete (0, _classPrivateFieldLooseBase2.default)(this, _queued)[_queued][id];\n          } catch (error) {\n            l.error(error);\n          }\n        });\n      }\n    });\n    const endpoints = Array.isArray(endpoint) ? endpoint : [endpoint];\n    (0, _util.assert)(endpoints.length !== 0, 'WsProvider requires at least one Endpoint');\n    endpoints.forEach(endpoint => {\n      (0, _util.assert)(/^(wss|ws):\\/\\//.test(endpoint), `Endpoint should start with 'ws://', received '${endpoint}'`);\n    });\n    (0, _classPrivateFieldLooseBase2.default)(this, _eventemitter)[_eventemitter] = new _eventemitter2.default();\n    (0, _classPrivateFieldLooseBase2.default)(this, _autoConnectMs)[_autoConnectMs] = autoConnectMs || 0;\n    (0, _classPrivateFieldLooseBase2.default)(this, _coder)[_coder] = new _coder2.default();\n    (0, _classPrivateFieldLooseBase2.default)(this, _endpointIndex)[_endpointIndex] = -1;\n    (0, _classPrivateFieldLooseBase2.default)(this, _endpoints)[_endpoints] = endpoints;\n    (0, _classPrivateFieldLooseBase2.default)(this, _headers)[_headers] = headers;\n    (0, _classPrivateFieldLooseBase2.default)(this, _websocket)[_websocket] = null;\n\n    if (autoConnectMs > 0) {\n      this.connectWithRetry().catch(() => {// does not throw\n      });\n    }\n  }\n  /**\n   * @summary `true` when this provider supports subscriptions\n   */\n\n\n  get hasSubscriptions() {\n    return true;\n  }\n  /**\n   * @summary Whether the node is connected or not.\n   * @return {boolean} true if connected\n   */\n\n\n  get isConnected() {\n    return (0, _classPrivateFieldLooseBase2.default)(this, _isConnected)[_isConnected];\n  }\n  /**\n   * @description Returns a clone of the object\n   */\n\n\n  clone() {\n    return new WsProvider((0, _classPrivateFieldLooseBase2.default)(this, _endpoints)[_endpoints]);\n  }\n  /**\n   * @summary Manually connect\n   * @description The [[WsProvider]] connects automatically by default, however if you decided otherwise, you may\n   * connect manually using this method.\n   */\n  // eslint-disable-next-line @typescript-eslint/require-await\n\n\n  async connect() {\n    try {\n      (0, _classPrivateFieldLooseBase2.default)(this, _endpointIndex)[_endpointIndex] = ((0, _classPrivateFieldLooseBase2.default)(this, _endpointIndex)[_endpointIndex] + 1) % (0, _classPrivateFieldLooseBase2.default)(this, _endpoints)[_endpoints].length;\n      (0, _classPrivateFieldLooseBase2.default)(this, _websocket)[_websocket] = typeof WebSocket !== 'undefined' && (0, _util.isChildClass)(WebSocket, _xWs.default) ? new _xWs.default((0, _classPrivateFieldLooseBase2.default)(this, _endpoints)[_endpoints][(0, _classPrivateFieldLooseBase2.default)(this, _endpointIndex)[_endpointIndex]]) // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n      // @ts-ignore - WS may be an instance of w3cwebsocket, which supports headers\n      : new _xWs.default((0, _classPrivateFieldLooseBase2.default)(this, _endpoints)[_endpoints][(0, _classPrivateFieldLooseBase2.default)(this, _endpointIndex)[_endpointIndex]], undefined, undefined, (0, _classPrivateFieldLooseBase2.default)(this, _headers)[_headers], undefined, {\n        // default: true\n        fragmentOutgoingMessages: true,\n        // default: 16K\n        fragmentationThreshold: 256 * 1024\n      });\n      (0, _classPrivateFieldLooseBase2.default)(this, _websocket)[_websocket].onclose = (0, _classPrivateFieldLooseBase2.default)(this, _onSocketClose)[_onSocketClose];\n      (0, _classPrivateFieldLooseBase2.default)(this, _websocket)[_websocket].onerror = (0, _classPrivateFieldLooseBase2.default)(this, _onSocketError)[_onSocketError];\n      (0, _classPrivateFieldLooseBase2.default)(this, _websocket)[_websocket].onmessage = (0, _classPrivateFieldLooseBase2.default)(this, _onSocketMessage)[_onSocketMessage];\n      (0, _classPrivateFieldLooseBase2.default)(this, _websocket)[_websocket].onopen = (0, _classPrivateFieldLooseBase2.default)(this, _onSocketOpen)[_onSocketOpen];\n    } catch (error) {\n      l.error(error);\n\n      (0, _classPrivateFieldLooseBase2.default)(this, _emit)[_emit]('error', error);\n\n      throw error;\n    }\n  }\n  /**\n   * @description Connect, never throwing an error, but rather forcing a retry\n   */\n\n\n  async connectWithRetry() {\n    try {\n      await this.connect();\n    } catch (error) {\n      setTimeout(() => {\n        this.connectWithRetry().catch(() => {// does not throw\n        });\n      }, (0, _classPrivateFieldLooseBase2.default)(this, _autoConnectMs)[_autoConnectMs] || RETRY_DELAY);\n    }\n  }\n  /**\n   * @description Manually disconnect from the connection, clearing autoconnect logic\n   */\n  // eslint-disable-next-line @typescript-eslint/require-await\n\n\n  async disconnect() {\n    try {\n      (0, _util.assert)(!(0, _util.isNull)((0, _classPrivateFieldLooseBase2.default)(this, _websocket)[_websocket]), 'Cannot disconnect on a non-connected websocket'); // switch off autoConnect, we are in manual mode now\n\n      (0, _classPrivateFieldLooseBase2.default)(this, _autoConnectMs)[_autoConnectMs] = 0; // 1000 - Normal closure; the connection successfully completed\n\n      (0, _classPrivateFieldLooseBase2.default)(this, _websocket)[_websocket].close(1000);\n\n      (0, _classPrivateFieldLooseBase2.default)(this, _websocket)[_websocket] = null;\n    } catch (error) {\n      l.error(error);\n\n      (0, _classPrivateFieldLooseBase2.default)(this, _emit)[_emit]('error', error);\n\n      throw error;\n    }\n  }\n  /**\n   * @summary Listens on events after having subscribed using the [[subscribe]] function.\n   * @param  {ProviderInterfaceEmitted} type Event\n   * @param  {ProviderInterfaceEmitCb}  sub  Callback\n   * @return unsubscribe function\n   */\n\n\n  on(type, sub) {\n    (0, _classPrivateFieldLooseBase2.default)(this, _eventemitter)[_eventemitter].on(type, sub);\n\n    return () => {\n      (0, _classPrivateFieldLooseBase2.default)(this, _eventemitter)[_eventemitter].removeListener(type, sub);\n    };\n  }\n  /**\n   * @summary Send JSON data using WebSockets to configured HTTP Endpoint or queue.\n   * @param method The RPC methods to execute\n   * @param params Encoded paramaters as appliucable for the method\n   * @param subscription Subscription details (internally used)\n   */\n\n\n  send(method, params, subscription) {\n    return new Promise((resolve, reject) => {\n      try {\n        const json = (0, _classPrivateFieldLooseBase2.default)(this, _coder)[_coder].encodeJson(method, params);\n\n        const id = (0, _classPrivateFieldLooseBase2.default)(this, _coder)[_coder].getId();\n\n        const callback = (error, result) => {\n          error ? reject(error) : resolve(result);\n        };\n\n        l.debug(() => ['calling', method, json]);\n        (0, _classPrivateFieldLooseBase2.default)(this, _handlers)[_handlers][id] = {\n          callback,\n          method,\n          params,\n          subscription\n        };\n\n        if (this.isConnected && !(0, _util.isNull)((0, _classPrivateFieldLooseBase2.default)(this, _websocket)[_websocket])) {\n          (0, _classPrivateFieldLooseBase2.default)(this, _websocket)[_websocket].send(json);\n        } else {\n          (0, _classPrivateFieldLooseBase2.default)(this, _queued)[_queued][id] = json;\n        }\n      } catch (error) {\n        reject(error);\n      }\n    });\n  }\n  /**\n   * @name subscribe\n   * @summary Allows subscribing to a specific event.\n   * @param  {string}                     type     Subscription type\n   * @param  {string}                     method   Subscription method\n   * @param  {any[]}                 params   Parameters\n   * @param  {ProviderInterfaceCallback} callback Callback\n   * @return {Promise<number>}                     Promise resolving to the dd of the subscription you can use with [[unsubscribe]].\n   *\n   * @example\n   * <BR>\n   *\n   * ```javascript\n   * const provider = new WsProvider('ws://127.0.0.1:9944');\n   * const rpc = new Rpc(provider);\n   *\n   * rpc.state.subscribeStorage([[storage.system.account, <Address>]], (_, values) => {\n   *   console.log(values)\n   * }).then((subscriptionId) => {\n   *   console.log('balance changes subscription id: ', subscriptionId)\n   * })\n   * ```\n   */\n\n\n  async subscribe(type, method, params, callback) {\n    const id = await this.send(method, params, {\n      callback,\n      type\n    });\n    return id;\n  }\n  /**\n   * @summary Allows unsubscribing to subscriptions made with [[subscribe]].\n   */\n\n\n  async unsubscribe(type, method, id) {\n    const subscription = `${type}::${id}`; // FIXME This now could happen with re-subscriptions. The issue is that with a re-sub\n    // the assigned id now does not match what the API user originally received. It has\n    // a slight complication in solving - since we cannot rely on the send id, but rather\n    // need to find the actual subscription id to map it\n\n    if ((0, _util.isUndefined)((0, _classPrivateFieldLooseBase2.default)(this, _subscriptions)[_subscriptions][subscription])) {\n      l.debug(() => `Unable to find active subscription=${subscription}`);\n      return false;\n    }\n\n    delete (0, _classPrivateFieldLooseBase2.default)(this, _subscriptions)[_subscriptions][subscription];\n    const result = await this.send(method, [id]);\n    return result;\n  }\n\n}\n\nexports.default = WsProvider;"]},"metadata":{},"sourceType":"script"}